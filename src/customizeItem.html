<!DOCTYPE html>
<html lang="en">
  <head>
    @@include('layout/head.html')
  </head>

  <body id="customizeItem">
    @@include('layout/top.html') @@include('layout/login.html')
    @@include('layout/nav.html')

    <main>
      <section class="container product-detail">
        <div class="row justify-content-between">
          <div
            data-tab-content
            class="imagery col-lg-6"
            style="background-image: url('./img/customize/color/brown.jpg')"
          >
            <img src="./img/customize/image/xr-brown.png" class="type-image" />
          </div>

          <div class="col-lg-6">
            <!-- action="customizeAdd.php" method="POST"-->
            <div
              id="orderDetail"
              class="detail margin_top_30"
              action=""
              method=""
            >
              <ul class="tabs catagory">
                <li
                  id="tab1"
                  name="table"
                  data-tab-target="#table"
                  class="tab padding_10"
                  value="1"
                  onclick="kind.value=1"
                >
                  原木圓桌
                </li>
                <li
                  id="tab2"
                  name="cabinet"
                  data-tab-target="#cabinet"
                  class="tab padding_10"
                  value="2"
                  onclick="kind.value=2"
                >
                  原木收納櫃
                </li>
                <li
                  id="tab3"
                  name="chair"
                  data-tab-target="#chair"
                  class="tab padding_10"
                  value="3"
                  onclick="kind.value=3"
                >
                  原木餐椅
                </li>
                <!-- 隱藏的input 用來放種類 用於傳value到資料庫-->
                <input type="hidden" id="kind" value="" name="kind" />
              </ul>
              <div class="options">
                <p class="margin_top_20">請選擇木材</p>
                <div class="colors btn_grid margin_top_20">
                  <div class="btn_wrap padding_10">
                    <input
                      type="button"
                      class="color brown padding_10 selected"
                      data-name="brown"
                      name="brown"
                      value="胡桃木"
                      onclick="color.value='胡桃木'"
                    />
                  </div>
                  <div class="btn_wrap padding_10">
                    <input
                      type="button"
                      class="color beige padding_10"
                      data-name="beige"
                      name="beige"
                      value="白梣木"
                      onclick="color.value='白梣木'"
                    />
                  </div>
                  <div class="btn_wrap padding_10">
                    <input
                      type="button"
                      class="color red padding_10"
                      data-name="red"
                      name="red"
                      value="紅橡木"
                      onclick="color.value='紅橡木'"
                    />
                  </div>
                  <div class="btn_wrap padding_10">
                    <input
                      type="button"
                      class="color green padding_10"
                      data-name="green"
                      name="green"
                      value="綠橡木"
                      onclick="color.value='綠橡木'"
                    />
                  </div>
                  <div class="btn_wrap padding_10">
                    <input
                      type="button"
                      class="color black padding_10"
                      data-name="black"
                      name="black"
                      value="黑梣木"
                      onclick="color.value='黑梣木'"
                    />
                  </div>
                  <!-- 隱藏的input 用來放木材顏色 用於傳value到資料庫-->
                  <input type="hidden" id="color" value="1" name="color" />
                </div>
                <div class="qty margin_top_20">
                  數量<br /><input
                    id="quantity"
                    type="number"
                    value="1"
                    name="quantity"
                  />
                </div>
                <!-- counter -->
                <!-- <div class="count__wrapper count__wrapper--ml .count">
                  <div class="qty-input">
                    <button class="qty-count qty-count--minus .count" data-action="minus" type="button">
                      <svg class="config__arrow" width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 2L3 7L8 12L7 14L0 7L7 0L8 2Z" fill="black" />
                      </svg>
                    </button>
                    <input class="product-qty input" type="number" name="product-qty" min="0" max="10" value="1">
                    <button class="qty-count qty-count--add" data-action="add" type="button">
                      <svg class="config__arrow" width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 2L5 7L0 12L1 14L8 7L1 0L0 2Z" fill="black" />
                      </svg>
                    </button>
                  </div>
                </div> -->
                <!-- Counter || END -->

                <div class="comment margin_top_20">
                  其他需求<br /><textarea id="detail" name="detail"></textarea>
                </div>

                <!-- Button trigger modal 按下送出訂製單出現彈窗 -->
                <div class="form-group margin_top_30 submit-btn">
                  <a
                    id="submit"
                    type="button"
                    class="btn_style"
                    data-toggle="modal"
                    >送出訂製單</a
                  >

                  <!-- Modal 彈窗 -->
                  <div id="myModal" class="modal">
                    <!-- Modal content -->
                    <div class="modal-content padding_20">
                      <span class="close">&times;</span>
                      <p>已提交客製化清單，工作人員會盡快與您聯繫確認，謝謝‧</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    @@include('layout/footer.html')

    <script>
      window.onload = function () {
        const color_btn_el = document.querySelectorAll(".colors .color");
        // console.log(color_btn_el); // 材質按鈕
        const imagery_el = document.querySelector("div.imagery");
        // console.log(imagery_el); // 圖片div
        const image_el = document.querySelector(".imagery .type-image");
        // console.log(image_el); //產品圖片img
        const search_obj = new URLSearchParams(location.search);
        // console.log(search_obj.get("tab")); // 1, 2, 3
        var catagory_btn = document.querySelectorAll("li.tab");
        // console.log(catagory_btn); // 種類按鈕陣列
        var img = document.querySelector(".type-image");
        var tableBtn = document.querySelector("#tab1");
        var cabinetBtn = document.querySelector("#tab2");
        var chairBtn = document.querySelector("#tab3");

        for (let i = 0; i < color_btn_el.length; i++) {
          let btn = color_btn_el[i];

          btn.addEventListener("click", function () {
            document
              .querySelector(".colors .color.selected")
              .classList.remove("selected");
            this.classList.add("selected");

            // 產品圖片變更
            // image_el.src = "./img/customize/image/xr-" + this.dataset.name + ".png";

            // 背景材質圖變更
            imagery_el.style.backgroundImage = `url('./img/customize/color/${this.dataset.name}.jpg')`;
            // console.log(imagery_el);
            // console.log(this.dataset.name); //red, green, black, brown, beige
          });
        }

        // 點擊按鈕, 款式圖片切換
        tableBtn.addEventListener("click", () => {
          img.src = "./img/customize/image/xr-brown.png";
        });
        cabinetBtn.addEventListener("click", () => {
          img.src = "./img/customize/image/cb-brown.png";
        });
        chairBtn.addEventListener("click", () => {
          img.src = "./img/customize/image/ch-brown.png";
        });

        //由customize.html進入, 對應tab的class加active
        if (search_obj.get("tab") == 1) {
          catagory_btn[0].classList.add("active"); //對應tab的class加active
          image_el.src = "./img/customize/image/xr-brown.png"; //對應的圖片
        } else if (search_obj.get("tab") == 2) {
          catagory_btn[1].classList.add("active");
          image_el.src = "./img/customize/image/cb-brown.png";
        } else {
          catagory_btn[2].classList.add("active");
          image_el.src = "./img/customize/image/ch-brown.png";
        }

        // 款式btn切換class
        var catagory_btn = document.querySelectorAll("li.tab");
        var tabContents = document.querySelectorAll("[data-tab-content]");

        catagory_btn.forEach((tab) => {
          tab.addEventListener("click", () => {
            tabContents.forEach((tabContent) => {
              tabContent.classList.remove("active");
            });
            catagory_btn.forEach((tab) => {
              tab.classList.remove("active");
            });
            tab.classList.add("active");
          });
        });

        // 隱藏的input 賦值種類value
        function kind() {
          var kind = document.getElementById("kind");
          // alert(kind.value);
        }

        // 隱藏的input 賦值顏色value
        function color() {
          var color = document.getElementById("color");
          // alert(color.value);
        }

        // 取input value, 賦值進mySQL table
        var submit = document.getElementById("submit");
        submit.addEventListener("click", function () {
          var kind = document.getElementById("kind").value;
          var color = document.getElementById("color").value;
          var quantity = document.getElementById("quantity").value;
          var detail = document.getElementById("detail").value;
          var loginStatus = JSON.parse(sessionStorage.getItem('status'));

          if ( loginStatus != true ){
            alert ( "請先登入會員!" );
            return
          }else{
            fetch("php/customizeAdd.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            mode: "cors",
            body: JSON.stringify({
              kind: kind,
              color: color,
              quantity: quantity,
              detail: detail,
            }),
          });

          // 按下送出訂製單後彈出modal, 3秒後重整頁面
          var modal = document.getElementById("myModal");
          var modalbBtn = document.getElementById("submit");
          var span = document.getElementsByClassName("close")[0];

          function refreshPage() {
            window.location.reload();
          }

          modalbBtn.onclick = function () {
            modal.style.display = "block";
            setTimeout(refreshPage, 4000);
          };

          span.onclick = function () {
            modal.style.display = "none";
            setTimeout(refreshPage, 4000);
          };

          window.onclick = function (event) {
            if (event.target == modal) {
              modal.style.display = "none";
              setTimeout(refreshPage, 4000);
            }
          };

          }
          
        });
        
      };
    </script>
  </body>
</html>
