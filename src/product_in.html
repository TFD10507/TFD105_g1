<!DOCTYPE html>
<html lang="en">
  <head>
    @@include('layout/head.html')

    <style>
      #productInfo .count button.count_btn {
        background-color: #fff;
        border-radius: 1px;
        padding: 0 10px;
      }

      #productInfo .count button.count_btn:first-child {
        font-size: 20px;
      }

      #productInfo .count span {
        margin: 0 10px;
      }
    </style>
  </head>
  <body class="product_in">
    <div class="wrapper">
      @@include('layout/login.html') @@include('layout/nav.html')
      <!-- 首頁 -->
      <section class="cart" id="productInfo">
        <main class="cart">
          <section class="main">
            <ul class="cart" v-if="pro[0]">
              <li class="photo">
                <img id="mainImg" class="mainImg product" :src="pro[0].pic" />
              </li>
              <li class="content">
                <h3 id="001" data-prd_id="001">{{pro[0].name}}</h3>
                <img
                  class="favorite"
                  src="./img/product/favorite.svg"
                  alt=""
                  srcset=""
                  @click.stop.prevent="add_love()"
                />
                <img
                  class="favorite"
                  src="./img/product/favorite_touch.svg"
                  alt=""
                  srcset=""
                  @click.stop.prevent="remove_love()"
                />

                <hr />
                <p class="content">{{pro[0].detail}}</p>
                <p>※可選擇等級的產品價格因等級而異。</p>
                <p>尺寸/規格：</p>
                <!-- 到時候加一欄尺寸 -->
                <!-- <p>{{pro[0].size}}</p> -->
                <p>{{pro[0].size}}</p>
                <!-- 先註解(vue出錯，沒辦法寫入js) -->
                <!-- <div class="count">
                  <button class="count_btn" @click="sub_btn">-</button>
                  <span>{{count}}</span>
                  <button class="count_btn" @click="add_btn">+</button>
                </div>
                <div class="product__buy pr-0">
                  <div class="product__buy-container">
                    <p class="subtotal__price price">
                      {{pro[0].price * count}}
                    </p>
                  </div> -->
                </div>
                <br />
                <button class="submit" type="submit" @click="addcart">
                  加入購物車
                </button>
              </li>
            </ul>
          </section>
        </main>
      </section>
      @@include('layout/top.html') @@include('layout/footer.html')
    </div>

    <script>
      var productInfo = new Vue({
        el: "#productInfo",
        data: {
          product: {
            id: "",
          },
          pro: [],
          image: "",
          name: "",
        },
        beforeCreate() {
          let urlParams = new URLSearchParams(window.location.search);
          this.id = urlParams.get("id");          
          },
        methods: {
          addcart() {
            alert(123);
          },         
          test(){
            let proimg = document.querySelector("#mainImg");
            let storagedata={
                product_id:this.id,
                product_img:proimg.src,
                product_name:$('#001').text(),                
            } 
          } ,
          add_love() {
            //抓取產品id
            console.log(this.id);
            console.log(this.name);
            
            let fabtn = document.querySelectorAll(".favorite");
            fabtn[1].classList.add("-on");
            // console.log(fabtn);
            // let proimg = document.querySelector("#mainImg");
        
            // let storagedata={
            //     product_id:this.id,
            //     product_img:proimg.src,
            //     product_name:$('#001').text(),                
            // }          
            test()
             // 設定條件式,為了讓下面的值設為null
             let myList = sessionStorage.getItem("collect");          
            // test2藉由click觸發下列事件
            //假設mylist裡面有東西的時候
            // for(let i = 0;i<=myListArray.length;i++){
            // }            
            if(myList != null ){

            // 設定myListArray=物件化過的myList
            let myListArray = JSON.parse(myList);
            // 將storagedata推入myListArray
            myListArray.push(storagedata);
            // 將sessionstorage推入myListArray
            sessionStorage.setItem("collect", JSON.stringify(myListArray));      
          }  
            else{
              sessionStorage.setItem("collect", JSON.stringify([storagedata]));
            }
            this.$options.methods.remove_love();
        },
        remove_love(){
          test()
          // let Sam = sessionStorage.getItem("collect");
          
          console.log(storagedata);
          // console.log(Sam);


          // let fabtn = document.querySelectorAll(".favorite");
          // console.log(fabtn);
          // fabtn[1].classList.remove("-on");
          
        // console.log(myListArray);
            // 移除localstorage的某項
            // for (let i = 0 ; i<=)
      
          }
        // add_love() {
          //   myListArray.pop(storagedata);
          // }
          
        },   
        mounted() {
          //  load
          // let heartStorage = localStorage.getItem("collect");          
          // console.log(heartStorage);
          // if(mylist != null){
          // // 將mylist中的資料轉型為物件並丟入新建宣告myListArrayone中
          // let myListArrayone = JSON.parse(mylist);
          // console.log(myListArrayone);
          // }
          
          // for(let i = 0;i <= myListArray.length;i++){
          //   if(this.id ==mylist[i]){
          // }       
          // }         
          // 為了保留this，所以再另外再設定一個變數，因此設定一個區域變數"that"
          let that = this;
          $.ajax({
            //設定與php串接的鏈結
            url: "php/getproductInfo.php",
            // 可以使用POST或GET，不過抓取資料使用POST即可。
            type: "POST",           
            data: {
              id: this.id,              
            },
            success: function (resp) {
              //查看是否有抓到resp
              // console.log(resp); 
              let getResp = JSON.parse(resp);
              // 將php接收下來的東西設定函式resp，並用getResp去接轉型過後的resp
              that.pro = getResp;
              //從vue看資料即可，因為已經塞入vue的monted的生命週期
              // console.log(that.pro);
            },
          });
         
        },
      });

      // let main_img = document.querySelector('#mainImg');
      // let type = document.querySelectorAll('img.type');
      // let chair_style = document.querySelectorAll('img.chair_style');

      // //設定第一項為黑框樣式(初始值)
      // type[0].style = 'outline: black 2px solid;'
      // for (let i = 0; i < type.length; i++) {
      //     // console.log(type[i]);
      //     type[i].addEventListener("click", function () {
      //         // console.log(type[i]);
      //         //換主圖
      //         main_img.src = chair_style[i].src;
      //         // counter = 0;
      //         for (let j = 0; j < type.length; j++) {
      //             if (i == j) {
      //                 //設定黑框
      //                 type[i].style = 'outline: black 2px solid;'

      //                 let storagedata = {
      //                     product_img: $('.chair_img')[j].src,
      //                     product_name: $('#app').text()
      //                 }
      //                 sessionStorage.setItem('collect', JSON.stringify(storagedata))

      //             } else {
      //                 //如果沒選定則取消樣式
      //                 type[j].style = 'none;'
      //             }
      //         }
      //     })
      // }

      // let fabtn = document.querySelectorAll(".favorite");
      // console.log(fabtn);
      //   fabtn[0].addEventListener("click",)


      // // fabtn[0].addEventListener("click", function () {
      // //   fabtn[1].classList.toggle("-on");

      // //   fabtn[1].addEventListener("click", function () {
      // //     // console.log(fabtn[1]);
      // //     fabtn[1].classList.remove("-on");
      // //   });
      // });

      // // counter
      // var wrapper= document.querySelector('.count__wrapper'),
      // res= document.querySelector('.subtotal__price'),
      // input= wrapper.querySelector('input[class*=input]');

      // wrapper.addEventListener('click', e=>{
      //     var t= e.target;

      //     input.value= +input.value;

      //     if(t.closest('button[class*=--minus]')){
      //         --input.value;
      //     }
      //     else if(t.closest('button[class*=--add]')){
      //         ++input.value;
      //     }
      //     res.textContent= (300*input.value);
      // });
      //空心變實心
      //   console.log(fabtn);
      // fabtn[0].addEventListener("click", function (e) {
      //     fabtn[1].classList.add('-on')
      //     let a = JSON.parse(sessionStorage.getItem('collect'))
      //     // console.log(a);

      //     // let storagedata = {
      //     //     product_img: $('.chair_img')[0].src,
      //     //     product_name: $('#app').text()
      //     // }
      //     // sessionStorage.setItem('collect', JSON.stringify(storagedata))
      //     if( a == null) {
      //         let storagedata = {
      //             product_img: $('.chair_img')[0].src,
      //             product_name: $('#app').text()
      //         }
      //         sessionStorage.setItem('collect', JSON.stringify(storagedata))
      //     } else {
      //         sessionStorage.setItem('collect', JSON.stringify(a))
      //     }
      //     // console.log(a)
      // })
      // fabtn[1].addEventListener("click", function () {
      //     // console.log(fabtn[1]);
      //     fabtn[1].classList.remove('-on');
      //     sessionStorage.clear()
      // })

      // let fabtn = document.querySelectorAll(".favorite");
      // wrapper.addEventListener('click', e=>{
      // var t= e.target;

      // input.value= +input.value;

      // if(t.closest('button[class*=--minus]')){
      //     --input.value;
      // }
      // else if(t.closest('button[class*=--add]')){
      //     ++input.value;
      //  }
      // res.textContent= (300*input.value);
      // });
    </script>
    <script>
    </script>
  </body>
</html>
